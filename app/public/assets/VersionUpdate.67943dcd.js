import{n as N,h as V,m as M,t as J,u as X,B as Y,q as Z,p as ee}from"./ant-design-vue.f3cea403.js";import{d as te,j as k,o as se,K as c,L as b,f as t,Q as s,y as ue,S as E,A as d,P as S,F as oe,O as ae,M as B,q as g,N as y,t as q,m as ne,v as le}from"./@vue.f0dd5f4e.js";import{A as D,R as T,N as R,s as re}from"./index.76eb39cb.js";import{_ as L,a as f}from"./item.bfc40d70.js";import{G as ie,L as ce}from"./@ant-design.7151a3c8.js";import"./@babel.75b79d9b.js";import"./regenerator-runtime.83f8288d.js";import"./array-tree-filter.28ee0a5d.js";import"./omit.js.0925d6dc.js";import"./lodash-es.ba98d3f1.js";import"./moment.08a7f518.js";import"./warning.ca82f8e0.js";import"./resize-observer-polyfill.8deb1e21.js";import"./async-validator.1fa0d626.js";import"./scroll-into-view-if-needed.c68eec67.js";import"./compute-scroll-into-view.6058b3be.js";import"./dom-align.f1b5d360.js";import"./vue-types.6e6d84ba.js";import"./mark-ui.80cd89aa.js";import"./vue-router.51efbbda.js";import"./@ctrl.2e36ce53.js";import"./Card.0f515d6a.js";const{valid:de,coerce:pe,clean:_e,lt:me,gt:fe,SemVer:ve}=require("semver");class j{get value(){return this._value}set value(e){this._value=e}constructor(e){this._value=new ve(de(pe(_e(e,{loose:!0})))||"0.0.0")}lessThan(e){return me(this.value,e.value)}greaterThan(e){return fe(this.value,e.value)}toString(){return this.value.raw}static from(e){return new j(e)}}const{parse:Fe}=require("yaml"),U=require("compressing"),{resolve:P,join:he}=require("path"),{writeFileSync:ge}=require("fs");class be{async needUpdate(e){const u=await this.resolveLatestUrl(e),{data:o}=await D(u),l=Fe(o).version;return!!l&&j.from(l).greaterThan(j.from(T.app.call("getVersion")))}resolvePath(){return P("./resources/resource.zip")}async update(e,u){var m;console.log("update",e);const o=T.app.get("isPackaged");if(console.log("ispack",o),o){const r=await this.resolveResourseUrl(e);v("info","\u5F00\u59CB\u4E0B\u8F7D\u8FDC\u7A0B\u66F4\u65B0\u6587\u4EF6:"+r);const a=this.resolvePath();if(v("info","\u521B\u5EFA\u672C\u5730\u66F4\u65B0\u6587\u4EF6:"+a),r)try{const{data:i}=await D({url:r});var l=Buffer.from(i.content,"base64");const F=i;return v("info","\u521B\u5EFA\u672C\u5730\u5199\u5165\u6D41:"+a),ge(a,l),v("info","\u6B63\u5728\u89E3\u538B\u66F4\u65B0\u6587\u4EF6"),console.log("compressing.zip.uncompress",(m=U==null?void 0:U.zip)==null?void 0:m.uncompress),U.zip.uncompress(a.toString(),P(he(a.toString(),"../app/"))).then(h=>{v("success","\u66F4\u65B0\u5B8C\u6BD5,\u8BF7\u91CD\u542F\u8F6F\u4EF6!")}).catch(h=>{v("error","\u66F4\u65B0\u5931\u8D25:"+h.stack)}),F}catch(i){v("error","\u66F4\u65B0\u5931\u8D25:"+i.stack)}else v("error","\u66F4\u65B0\u8DEF\u5F84\u89E3\u6790\u5931\u8D25")}else v("error","\u5F53\u524D\u4E0D\u662F\u751F\u4EA7\u6A21\u5F0F\uFF0C\u4E0D\u80FD\u8FDB\u884C\u66F4\u65B0\u64CD\u4F5C")}}class Be extends be{async listTags(){const{data:e}=await D("https://gitee.com/api/v5/repos/enncy/online-course-script/tags"),u=[];for(const{name:o,message:l,commit:m}of e){const{data:r}=await D(`https://gitee.com/api/v5/repos/enncy/online-course-script/git/trees/${m.sha}?recursive=1`);let a="",i="",F="",h=0;for(const{path:C,size:x,sha:_}of r.tree)if(/ocs-app-resource\.zip/.test(C)&&(a=`https://gitee.com/enncy/online-course-script/blob/${o}/${C}`,i=`https://gitee.com/api/v5/repos/enncy/online-course-script/git/blobs/${_}`,h=x),/latest\.(yml|yaml)/.test(C)&&(F=`https://gitee.com/enncy/online-course-script/raw/${o}/${C}`),a&&F)break;if(a&&i&&F){u.push({name:o,message:l,latest:F,resourse:a,size:h,raw:i});break}}return u}async resolveResourseUrl(e){return e.raw}async resolveLatestUrl(e){return e.latest}}function v(p,e){console.log(e);const u="update-notify",o={duration:5,placement:"bottomRight",key:u,message:"\u66F4\u65B0\u7A0B\u5E8F",description:e,style:{padding:"12px"},class:"notification-message",onClose:()=>{N.close(u)}};N[p](o)}function I(p){return p>1024?p>1024*1024?(p/(1024*1024)).toFixed(2)+"MB":(p/1024).toFixed(2)+"KB":p+"Byte"}const ye={class:"aaa"},Ce=["onMouseenter"],ke={key:0},Ee=g("\u5207\u6362\u5230\u6B64\u7248\u672C"),we={key:1},De=["href"],je={class:"space-10 flex"},Ue={key:1},xe=g("\u9700\u8981\u66F4\u65B0"),Ae={key:2},ze=g("\u5DF2\u7ECF\u662F\u6700\u65B0\u7248\u672C"),Se={class:"space-10"},Te=B("span",null,"\u5C0F\u65F6",-1),Le={class:"space-10"},$e=g("\u66F4\u65B0\u68C0\u6D4B"),nt=te({setup(p){const e=V.PRESENTED_IMAGE_SIMPLE,{update:u}=re,o=k(0);k(3);const l=k(""),m=k([]),r=k(-1),a=new Be,i=k(!1);async function F(){if(i.value=!0,l.value="\u6B63\u5728\u83B7\u53D6\u7248\u672C\u5217\u8868",await R()){const _=await a.listTags();_.length===0?l.value="\u6682\u65E0\u7248\u672C":(l.value="\u83B7\u53D6\u6210\u529F",m.value=_),console.log("tags",_)}else l.value="\u7F51\u7EDC\u9519\u8BEF\uFF0C\u83B7\u53D6\u5931\u8D25";i.value=!1}async function h(){if(await R()){r.value=-1;const _=await a.needUpdate(ue(m.value.reverse()[0]));r.value=_?1:0,r.value===1?M.warn("\u9700\u8981\u66F4\u65B0"):M.success("\u5DF2\u7ECF\u662F\u6700\u65B0\u7248\u672C")}}function C(_){o.value=_}function x(){o.value=-1}return se(async()=>{await F(),await h()}),(_,w)=>{const G=J,O=V,K=ie,A=X,$=Y,Q=ce,W=Z,H=ee;return c(),b("div",null,[t(L,{title:"\u7248\u672C\u5217\u8868",color:"blue","close-collapse":""},{default:s(()=>[i.value?(c(),E(G,{key:0})):m.value.length===0?(c(),E(O,{key:1,image:d(e),description:l.value},null,8,["image","description"])):S("",!0),(c(!0),b(oe,null,ae(m.value,(n,z)=>(c(),b("div",ye,[B("div",{onMouseenter:Ne=>C(z),onMouseleave:x},[t(f,null,{label:s(()=>[t(A,null,{default:s(()=>[t(K),g(y(n.name),1)]),_:2},1024)]),default:s(()=>[t(q,{name:"fade",mode:"out-in",duration:100},{default:s(()=>[o.value===z?(c(),b("span",ke,[t($,{type:"link",size:"small",style:{"line-height":"10px",height:"10px"},onClick:()=>{d(a).update(n)}},{default:s(()=>[Ee]),_:2},1032,["onClick"])])):(c(),b("span",we," - "+y(d(I)(n.size)),1))]),_:2},1024)]),_:2},1024),t(q,{name:"collapse"},{default:s(()=>[ne(t(L,{"close-collapse":"",size:"small",style:{"text-align":"left",height:"84px"}},{default:s(()=>[t(f,{"font-bold":"",label:"\u63CF\u8FF0"},{default:s(()=>[g(y(n.message||"\u65E0"),1)]),_:2},1024),n.size?(c(),E(f,{key:0,"font-bold":"",label:"\u5927\u5C0F"},{default:s(()=>[g(y(d(I)(n.size)),1)]),_:2},1024)):S("",!0),n.resourse?(c(),E(f,{key:1,"font-bold":"",label:"\u6E90\u7801"},{default:s(()=>[B("a",{href:n.resourse},y(n.resourse),9,De)]),_:2},1024)):S("",!0)]),_:2},1536),[[le,o.value===z]])]),_:2},1024)],40,Ce)]))),256))]),_:1}),t(L,{title:"\u66F4\u65B0\u8BBE\u7F6E",color:"blue"},{default:s(()=>[t(f,{label:"\u5F53\u524D\u7248\u672C","font-bold":""},{default:s(()=>[B("span",je,[B("span",null,y(d(T).app.call("getVersion")),1),r.value===-1?(c(),E(Q,{key:0})):r.value===1?(c(),b("div",Ue,[t(A,{color:"#f50"},{default:s(()=>[xe]),_:1})])):(c(),b("div",Ae,[t(A,{color:"#87d068"},{default:s(()=>[ze]),_:1})]))])]),_:1}),t(f,{"font-bold":"",label:"\u4E0A\u6B21\u68C0\u6D4B\u65F6\u95F4"},{default:s(()=>[g(y(new Date(d(u).lastTime).toLocaleString()),1)]),_:1}),t(f,{"font-bold":"",label:"\u81EA\u52A8\u66F4\u65B0"},{default:s(()=>[t(W,{checked:d(u).autoUpdate,"onUpdate:checked":w[0]||(w[0]=n=>d(u).autoUpdate=n)},null,8,["checked"])]),_:1}),t(f,{"font-bold":"",label:"\u81EA\u52A8\u66F4\u65B0\u95F4\u9694"},{default:s(()=>[B("div",Se,[t(H,{size:"small",min:1,max:24,"default-value":1,value:d(u).hour,"onUpdate:value":w[1]||(w[1]=n=>d(u).hour=n),disabled:!d(u).autoUpdate},null,8,["value","disabled"]),Te])]),_:1}),t(f,{"font-bold":"",label:"\u64CD\u4F5C"},{default:s(()=>[B("div",Le,[t($,{type:"primary",disabled:r.value===-1,onClick:h,size:"small"},{default:s(()=>[$e]),_:1},8,["disabled"])])]),_:1})]),_:1})])}}});export{nt as default};
