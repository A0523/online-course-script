import{m as A,A as X,v as ie,w as re,x as de,I as pe,y as ce,z as _e,E as fe,F as me,S as ve,j as ge,M as J,B as K,G as Z,i as Y,H as Be,u as he,h as ee,J as Fe,K as ye}from"./ant-design-vue.f3cea403.js";import{c as $,F as L,P as te,a as oe,R as ue,N as xe}from"./index.76eb39cb.js";import{d as M,J as G,j,K as i,L as g,f as t,Q as u,Z as be,A as e,X as ne,M as a,N as p,r as H,q as f,S as w,P as U,F as k,O as Q,y as W,u as Ee}from"./@vue.f0dd5f4e.js";import{T as we,a as Ce,A as De}from"./task.26aecec3.js";import{L as ke,H as Ie,J as Ae,K as Le,M as je,k as Se}from"./@ant-design.7151a3c8.js";import{u as $e}from"./vue-router.51efbbda.js";import"./@babel.75b79d9b.js";import"./regenerator-runtime.83f8288d.js";import"./array-tree-filter.28ee0a5d.js";import"./omit.js.0925d6dc.js";import"./lodash-es.ba98d3f1.js";import"./moment.08a7f518.js";import"./warning.ca82f8e0.js";import"./resize-observer-polyfill.8deb1e21.js";import"./async-validator.1fa0d626.js";import"./scroll-into-view-if-needed.c68eec67.js";import"./compute-scroll-into-view.6058b3be.js";import"./dom-align.f1b5d360.js";import"./vue-types.6e6d84ba.js";import"./mark-ui.80cd89aa.js";import"./@ctrl.2e36ce53.js";const Ue={class:"space-10"},ze={class:"font-v2"},se=M({props:{user:{type:null,required:!0},detail:{type:Boolean,required:!1},showImg:{type:Boolean,required:!1},showOnly:{type:Boolean,required:!1}},emits:["update"],setup(S,{emit:B}){const C=S,{user:b,detail:r,showImg:F,showOnly:y}=G(C),o=j([]);function E(c){o.value.length>=$.setting.common.task.maxTasks?A.warn("\u8BF7\u4E0D\u8981\u8D85\u51FA\u6700\u5927\u4EFB\u52A1\u6570\u91CF: "+$.setting.common.task.maxTasks+" \uFF0C\u53EF\u4EE5\u5230\u901A\u7528\u8BBE\u7F6E\u91CC\u914D\u7F6E!"):(o.value.some(v=>v.id===c.id)?o.value=o.value.filter(v=>v.id!==c.id):o.value.push(c),l())}function l(){B("update",o.value)}return(c,v)=>{const D=X,x=ie,m=re,h=de;return i(),g("div",null,[t(h,{class:"course-list","item-layout":"horizontal","data-source":e(b).courses.filter(n=>n.platform===e(b).platform)},{renderItem:u(({item:n})=>[t(m,{onClick:d=>E(n),class:be(!e(y)&&o.value.some(d=>d.id===n.id)?"course-list-item selected":"course-list-item")},{default:u(()=>[t(x,{description:e(r)?n.profile:""},ne({title:u(()=>[a("a",Ue,[a("span",ze,p(n.name),1)])]),_:2},[e(F)?{name:"avatar",fn:u(()=>[t(D,{src:n.img,shape:"square",style:{width:"86px",height:"100%"}},null,8,["src"])])}:void 0]),1032,["description"])]),_:2},1032,["onClick","class"])]),_:1},8,["data-source"])])}}});const Te={id:"user-form"},Oe=["textContent"],Me={class:"space-10 flex jc-flex-end margin-top-8"},le=M({props:{btnText:{type:String,required:!0},user:{type:null,required:!1},mode:{type:String,required:!0}},emits:["ok"],setup(S,{emit:B}){const C=S,b=require("uuid"),{btnText:r,user:F,mode:y}=G(C),o=H((F==null?void 0:F.value)||x()),E=j(!1),l=H([]);function c(){console.log("mode.value",y.value),y.value==="modify"&&(o.updateTime=Date.now()),B("ok",o)}function v(){return l.length!==0?l[(l==null?void 0:l.length)-1].status==="finish"||(l==null?void 0:l.some(h=>h.status==="error")):!1}async function D(){E.value=!0;const h=ue.script.call("getCourseList",o.loginScript,W(o));h&&(Object.assign(l,we(h)),Ce({baseTasks:l,finish(n,d){(l==null?void 0:l[l.length-1].status)==="finish"&&(d.length!==0?(Object.assign(o.courses,o.courses.filter(_=>_.platform!==o.platform).concat(d)),A.success("\u8BFE\u7A0B\u5217\u8868\u83B7\u53D6\u6210\u529F!"),setTimeout(()=>{E.value=!1},2e3)):A.error("\u8BFE\u7A0B\u5217\u8868\u83B7\u53D6\u5931\u8D25 , \u8BF7\u91CD\u65B0\u83B7\u53D6!"))},error(n,d){A.error("\u8BFE\u7A0B\u5217\u8868\u83B7\u53D6\u5931\u8D25 , \u8BF7\u91CD\u65B0\u83B7\u53D6!")}}))}function x(){return{uid:b.v4().replace(/-/g,""),name:"",loginTime:0,delete:!1,updateTime:Date.now(),createTime:Date.now(),platform:"cx",loginScript:"cx-user-login",courses:[],loginInfo:{cx:{phoneLogin:{phone:""},unitLogin:{password:"",uname:"",unitname:""},userLogin:{password:"",phone:""}},zhs:{phoneLogin:{password:"",phone:""},studentIdLogin:{password:"",school:"",studentId:""}}}}}function m(h){return oe[h].split("-").slice(1).join("-")}return(h,n)=>{const d=pe,_=ce,I=_e,z=fe,q=me,N=ve,O=ge,P=J,T=K,R=Z,V=Y;return i(),g("div",null,[a("div",Te,[t(q,{"label-col":{span:4},"wrapper-col":{span:19}},{default:u(()=>[t(_,{label:"\u7528\u6237\u540D\u5B57/\u5907\u6CE8"},{default:u(()=>[t(d,{value:e(o).name,"onUpdate:value":n[0]||(n[0]=s=>e(o).name=s)},null,8,["value"])]),_:1}),t(_,{label:"\u5E73\u53F0\u7C7B\u578B"},{default:u(()=>[t(z,{"default-value":e(o).platform||"cx",onChange:n[3]||(n[3]=s=>{e(o).platform=s.target.value})},{default:u(()=>[t(I,{value:"cx",onClick:n[1]||(n[1]=s=>e(o).loginScript=e(L)("cx-user-login"))},{default:u(()=>[f(p(e(te).cx),1)]),_:1}),t(I,{value:"zhs",onClick:n[2]||(n[2]=s=>e(o).loginScript=e(L)("zhs-phone-login"))},{default:u(()=>[f(p(e(te).zhs),1)]),_:1})]),_:1},8,["default-value"])]),_:1}),t(_,{label:"\u767B\u5F55\u7C7B\u578B"},{default:u(()=>[e(o).platform==="cx"?(i(),w(z,{key:0,"default-value":e(o).loginScript,onChange:n[4]||(n[4]=s=>e(o).loginScript=s.target.value)},{default:u(()=>[t(I,{value:e(L)("cx-user-login")},{default:u(()=>[f(p(m("cx-user-login")),1)]),_:1},8,["value"]),t(I,{value:e(L)("cx-phone-login")},{default:u(()=>[f(p(m("cx-phone-login")),1)]),_:1},8,["value"]),t(I,{value:e(L)("cx-unit-login")},{default:u(()=>[f(p(m("cx-unit-login")),1)]),_:1},8,["value"])]),_:1},8,["default-value"])):e(o).platform==="zhs"?(i(),w(z,{key:1,"default-value":e(o).loginScript,onChange:n[5]||(n[5]=s=>e(o).loginScript=s.target.value)},{default:u(()=>[t(I,{value:e(L)("zhs-phone-login")},{default:u(()=>[f(p(m("zhs-phone-login")),1)]),_:1},8,["value"]),t(I,{value:e(L)("zhs-studentId-login")},{default:u(()=>[f(p(m("zhs-studentId-login")),1)]),_:1},8,["value"])]),_:1},8,["default-value"])):U("",!0)]),_:1}),e(o).platform==="cx"?(i(),g(k,{key:0},[e(o).loginScript==="cx-user-login"?(i(),g(k,{key:0},[t(_,{label:"\u8D26\u53F7"},{default:u(()=>[t(d,{value:e(o).loginInfo.cx.userLogin.phone,"onUpdate:value":n[6]||(n[6]=s=>e(o).loginInfo.cx.userLogin.phone=s),valueModifiers:{trim:!0}},null,8,["value"])]),_:1}),t(_,{label:"\u5BC6\u7801"},{default:u(()=>[t(d,{value:e(o).loginInfo.cx.userLogin.password,"onUpdate:value":n[7]||(n[7]=s=>e(o).loginInfo.cx.userLogin.password=s),valueModifiers:{trim:!0}},null,8,["value"])]),_:1})],64)):e(o).loginScript==="cx-phone-login"?(i(),w(_,{key:1,label:"\u624B\u673A\u53F7"},{default:u(()=>[t(d,{value:e(o).loginInfo.cx.phoneLogin.phone,"onUpdate:value":n[8]||(n[8]=s=>e(o).loginInfo.cx.phoneLogin.phone=s),valueModifiers:{trim:!0}},null,8,["value"])]),_:1})):e(o).loginScript==="cx-unit-login"?(i(),g(k,{key:2},[t(_,{label:"\u5B66\u6821/\u5355\u4F4D"},{default:u(()=>[t(d,{value:e(o).loginInfo.cx.unitLogin.unitname,"onUpdate:value":n[9]||(n[9]=s=>e(o).loginInfo.cx.unitLogin.unitname=s),valueModifiers:{trim:!0}},null,8,["value"])]),_:1}),t(_,{label:"\u5DE5\u53F7/\u5B66\u53F7"},{default:u(()=>[t(d,{value:e(o).loginInfo.cx.unitLogin.uname,"onUpdate:value":n[10]||(n[10]=s=>e(o).loginInfo.cx.unitLogin.uname=s),valueModifiers:{trim:!0}},null,8,["value"])]),_:1}),t(_,{label:"\u5BC6\u7801"},{default:u(()=>[t(d,{value:e(o).loginInfo.cx.unitLogin.password,"onUpdate:value":n[11]||(n[11]=s=>e(o).loginInfo.cx.unitLogin.password=s),valueModifiers:{trim:!0}},null,8,["value"])]),_:1})],64)):U("",!0)],64)):e(o).platform==="zhs"?(i(),g(k,{key:1},[e(o).loginScript==="zhs-phone-login"?(i(),g(k,{key:0},[t(_,{label:"\u624B\u673A\u53F7"},{default:u(()=>[t(d,{value:e(o).loginInfo.zhs.phoneLogin.phone,"onUpdate:value":n[12]||(n[12]=s=>e(o).loginInfo.zhs.phoneLogin.phone=s),valueModifiers:{trim:!0}},null,8,["value"])]),_:1}),t(_,{label:"\u5BC6\u7801"},{default:u(()=>[t(d,{value:e(o).loginInfo.zhs.phoneLogin.password,"onUpdate:value":n[13]||(n[13]=s=>e(o).loginInfo.zhs.phoneLogin.password=s),valueModifiers:{trim:!0}},null,8,["value"])]),_:1})],64)):e(o).loginScript==="zhs-studentId-login"?(i(),g(k,{key:1},[t(_,{label:"\u5B66\u6821\u540D "},{default:u(()=>[t(d,{value:e(o).loginInfo.zhs.studentIdLogin.school,"onUpdate:value":n[14]||(n[14]=s=>e(o).loginInfo.zhs.studentIdLogin.school=s),valueModifiers:{trim:!0}},null,8,["value"])]),_:1}),t(_,{label:"\u5927\u5B66\u5B66\u53F7"},{default:u(()=>[t(d,{value:e(o).loginInfo.zhs.studentIdLogin.studentId,"onUpdate:value":n[15]||(n[15]=s=>e(o).loginInfo.zhs.studentIdLogin.studentId=s),valueModifiers:{trim:!0}},null,8,["value"])]),_:1}),t(_,{label:"\u5BC6\u7801"},{default:u(()=>[t(d,{value:e(o).loginInfo.zhs.studentIdLogin.password,"onUpdate:value":n[16]||(n[16]=s=>e(o).loginInfo.zhs.studentIdLogin.password=s),valueModifiers:{trim:!0}},null,8,["value"])]),_:1})],64)):U("",!0)],64)):U("",!0),e(o).courses.length!==0?(i(),w(_,{key:2,label:"\u8BFE\u7A0B"},{default:u(()=>[t(se,{user:e(o),detail:"","show-img":"","show-only":!0},null,8,["user"])]),_:1})):U("",!0)]),_:1}),t(P,{visible:E.value,"onUpdate:visible":n[17]||(n[17]=s=>E.value=s),footer:null,centered:"",title:"",width:700,maskClosable:!1,keyboard:!1,closable:v(),destroyOnClose:!0},{default:u(()=>[t(O,{style:{padding:"20px 12px 0px 12px"}},{default:u(()=>[(i(!0),g(k,null,Q(e(l),(s,ae)=>(i(),w(N,{key:ae,title:s.name,status:s.status},ne({description:u(()=>[a("span",{style:{"white-space":"nowrap"},textContent:p(s.msg?s.msg:s.status==="wait"?"\u7B49\u5F85\u4E2D":s.status==="process"?"\u6B63\u5728\u8FD0\u884C":s.status==="finish"?"\u5DF2\u5B8C\u6210":"\u9519\u8BEF")},null,8,Oe)]),_:2},[s.status==="process"?{name:"icon",fn:u(()=>[t(e(ke))])}:void 0]),1032,["title","status"]))),128))]),_:1})]),_:1},8,["visible","closable"])]),a("div",Me,[t(R,{placement:"top","ok-text":"\u786E\u8BA4","cancel-text":"\u53D6\u6D88",title:"\u4F60\u786E\u5B9A\u8981\u91CD\u65B0\u83B7\u53D6\u8BFE\u7A0B\u5417",onConfirm:n[18]||(n[18]=s=>D())},{default:u(()=>[t(T,{type:"primary"},{default:u(()=>[f(p(e(y)==="create"?"\u83B7\u53D6\u8BFE\u7A0B\u5217\u8868":"\u91CD\u65B0\u83B7\u53D6\u8BFE\u7A0B\u5217\u8868"),1)]),_:1})]),_:1}),e(o).courses.length===0?(i(),w(V,{key:0,content:"\u8BF7\u5148\u83B7\u53D6\u8BFE\u7A0B\u5217\u8868\uFF0C\u4E4B\u540E\u624D\u80FD\u6DFB\u52A0 "},{default:u(()=>[t(T,{type:"primary",disabled:!0},{default:u(()=>[f(p(e(r)),1)]),_:1})]),_:1})):(i(),w(T,{key:1,type:"primary",onClick:c},{default:u(()=>[f(p(e(r)),1)]),_:1}))])])}}}),qe={class:"font-v3",style:{"white-space":"nowrap",overflow:"auto"}},Ne=a("span",{class:"font-v2"},"\u5907\u6CE8",-1),Pe=a("span",{class:"font-v2"},"uid",-1),Re=a("span",{class:"font-v2"},"\u521B\u5EFA\u65F6\u95F4",-1),Ve=a("span",{class:"font-v2"},"\u66F4\u65B0\u65F6\u95F4",-1),Je=a("span",{class:"font-v2"},"\u6700\u8FD1\u767B\u5F55",-1),Ke=a("span",{class:"font-v2"},"\u8BFE\u7A0B\u6570",-1),Ge={class:"user-info"},He={class:"flex ai-baseline space-10"},Qe={class:"font-v4"},We={class:"space-10 margin-bottom-10 flex nowrap"},Xe={style:{"white-space":"nowrap"}},Ze={key:0,class:"flex nowrap",style:{"overflow-x":"auto"}},Ye={key:1,style:{"max-height":"340px",overflow:"auto"}},et={class:"padding-top-24 flex jc-flex-end"},tt=f("\u5F00\u59CB\u5237\u8BFE"),ot=M({props:{user:{type:null,required:!0}},emits:["delete","modify"],setup(S,{emit:B}){const C=S,b=$e(),{user:r}=G(C),F=j(!1),y=j(!1),o=j([]);function E(){F.value=!1,A.success("\u4FEE\u6539\u6210\u529F\uFF01"),B("modify",r.value)}function l(){F.value=!0}function c(x){o.value=x}function v(){y.value=!0}async function D(){if(await xe()){for(const x of o.value){const m=H(ue.script.call("start",r.value.loginScript,W(r.value),W(x)));De({target:m,course:x,user:r.value}),A.success(x.name+" \u542F\u52A8\u6210\u529F\uFF01")}setTimeout(()=>{y.value=!1,b.push("/task")},500)}}return(x,m)=>{const h=Ie,n=Z,d=Y,_=Ae,I=Le,z=je,q=X,N=Be,O=J,P=he,T=ee,R=K,V=Fe;return i(),w(V,{hoverable:"",style:{width:"260px",margin:"8px"},bodyStyle:{padding:"12px",display:"flex",alignItems:"baseline"}},{actions:u(()=>[t(d,{content:"\u5220\u9664"},{default:u(()=>[t(n,{title:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u4E2A\u8D26\u53F7\u5417","ok-text":"\u786E\u5B9A","cancel-text":"\u53D6\u6D88",onConfirm:m[0]||(m[0]=s=>B("delete",e(r)))},{default:u(()=>[t(h)]),_:1})]),_:1}),t(d,{content:"\u4FEE\u6539"},{default:u(()=>[t(_,{onClick:l})]),_:1}),t(d,{content:"\u542F\u52A8"},{default:u(()=>[t(I,{onClick:v})]),_:1})]),default:u(()=>[t(N,null,{title:u(()=>[t(d,{title:"\u8BE6\u60C5\u4FE1\u606F"},{content:u(()=>[a("div",qe,[a("div",null,[Ne,f(" : "+p(e(r).name),1)]),a("div",null,[Pe,f(" : "+p(e(r).uid),1)]),a("div",null,[Re,f(" : "+p(new Date(e(r).createTime).toLocaleString()),1)]),a("div",null,[Ve,f(" : "+p(new Date(e(r).updateTime).toLocaleString()),1)]),a("div",null,[Je,f(" : "+p(e(r).loginTime?new Date(e(r).loginTime).toLocaleString():"\u65E0"),1)]),a("div",null,[Ke,f(" : \u5171\u6709 "+p(e(r).courses.filter(s=>s.platform===e(r).platform).length)+" \u95E8\u8BFE\u7A0B ",1)])])]),default:u(()=>[a("div",Ge,[a("div",He,[a("span",null,p(e(r).name),1),a("span",Qe,p(e(oe)[e(r).loginScript]),1)])])]),_:1})]),avatar:u(()=>[t(q,null,{icon:u(()=>[t(z)]),_:1})]),_:1}),t(O,{visible:F.value,"onUpdate:visible":m[1]||(m[1]=s=>F.value=s),title:"\u4FEE\u6539\u7528\u6237",width:740,style:{top:"42px"},footer:null,destroyOnClose:!0},{default:u(()=>[t(le,{onOk:E,btnText:"\u4FEE\u6539",user:e(r),mode:"modify"},null,8,["user"])]),_:1},8,["visible"]),t(O,{visible:y.value,"onUpdate:visible":m[2]||(m[2]=s=>y.value=s),title:"\u9009\u62E9\u542F\u52A8\u8BFE\u7A0B",width:740,style:{top:"42px"},footer:null,destroyOnClose:!0},{default:u(()=>[a("div",We,[a("span",Xe," \u5DF2\u9009\u8BFE\u7A0B:"+p(o.value.length!==0?"":"\u6682\u65E0"),1),o.value.length!==0?(i(),g("span",Ze,[t(Ee,{name:"fade"},{default:u(()=>[(i(!0),g(k,null,Q(o.value,s=>(i(),w(P,{class:"margin-top-2",color:"#2db7f5",key:s.id},{default:u(()=>[f(p(s.name),1)]),_:2},1024))),128))]),_:1})])):U("",!0)]),e(r).courses.filter(s=>s.platform===e(r).platform).length===0?(i(),w(T,{key:0,description:"\u6B64\u5E73\u53F0\u6682\u65E0\u8BFE\u7A0B\uFF0C\u8BF7\u70B9\u51FB\u4E0B\u65B9\u6309\u94AE\u83B7\u53D6"})):(i(),g("div",Ye,[t(se,{user:e(r),detail:"","show-img":"",onUpdate:c},null,8,["user"])])),a("div",et,[t(R,{class:"margin-right-24",type:"primary",onClick:D},{default:u(()=>[tt]),_:1})])]),_:1},8,["visible"])]),_:1})}}});const ut={style:{"text-align":"center",padding:"0px 50px",height:"100%"}},nt={key:0,style:{width:"100%",height:"100%"},class:"flex jc-center ac-center ai-center"},st=f(" \u6DFB\u52A0\u8D26\u53F7 "),lt={style:{margin:"18px auto",width:"420px"}},at={class:"flex wrap"},it={style:{width:"210px",height:"100px"},class:"flex ac-center ai-center jc-center add-card"},At=M({setup(S){!!$.users&&$.users.length===0&&($.users=[]);const B=$.users,C=j(!1),b=j(""),r=l=>{C.value=!1,B.push(l),console.log("add-user",l),A.success("\u521B\u5EFA\u6210\u529F!")};function F(l){return l.filter(v=>{if(v.name.indexOf(b.value)!==-1)return v;for(const D in v.loginInfo)if(v.loginInfo[D].toString().indexOf(b.value)!==-1)return v})}function y(l){B.splice(B.findIndex(c=>c.uid===l.uid),1)}function o(l){Object.assign(B,B.map(c=>c.uid===l.uid?l:c))}function E(){C.value=!0}return(l,c)=>{const v=Se,D=K,x=ee,m=ye,h=J;return i(),g("div",ut,[e(B).length===0?(i(),g("div",nt,[t(x,{description:""},{default:u(()=>[t(D,{type:"primary",shape:"round",onClick:E},{icon:u(()=>[t(v)]),default:u(()=>[st]),_:1})]),_:1})])):(i(),g(k,{key:1},[a("div",lt,[t(m,{value:b.value,"onUpdate:value":c[0]||(c[0]=n=>b.value=n),placeholder:"\u8F93\u5165\u540D\u5B57\uFF0C\u6216\u8005\u5176\u4ED6\u4FE1\u606F\u7247\u6BB5","enter-button":"",style:{"border-radius":"12px"}},null,8,["value"])]),a("div",at,[(i(!0),g(k,null,Q(F(e(B)),n=>(i(),w(ot,{user:n,onDelete:y,onModify:o},null,8,["user"]))),256)),a("div",it,[t(D,{type:"primary",shape:"circle",onClick:E},{icon:u(()=>[t(v)]),_:1})])])],64)),t(h,{visible:C.value,"onUpdate:visible":c[1]||(c[1]=n=>C.value=n),title:"\u6DFB\u52A0\u7528\u6237",width:740,style:{top:"42px"},footer:null,destroyOnClose:!0},{default:u(()=>[t(le,{onOk:r,btnText:"\u6DFB\u52A0",mode:"create"})]),_:1},8,["visible"])])}}});export{At as default};
